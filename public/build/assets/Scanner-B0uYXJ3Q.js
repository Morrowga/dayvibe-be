import{k as n,m as H,r as T,f as d,a as C,u as J,w as _,F as U,o as l,Z as W,b as e,n as D,t as r,d as F,g as i,q as Z,B as X,z as Y,C as ee,D as P,c as te}from"./app-ddjbEfWL.js";import{_ as se}from"./AuthenticatedLayout-D8rpeWvk.js";const oe={class:"py-12"},ae={class:"max-w-4xl mx-auto sm:px-6 lg:px-8 space-y-6"},re={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},le={class:"p-6"},de={class:"flex space-x-4"},ne={key:0,class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ie={class:"p-6"},ue={class:"flex flex-col items-center"},ce={class:"text-lg font-medium text-gray-700 mb-2"},me={key:0,class:"mt-6"},ve={class:"flex items-start space-x-4"},ge=["src"],pe={class:"flex-1"},be={class:"text-sm text-gray-600 mb-2"},fe={class:"text-sm text-gray-600 mb-4"},xe={class:"w-full md:w-1/2"},he=["disabled"],ye={key:1,class:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded"},we={key:1,class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},_e={class:"p-6"},ke={class:"flex space-x-4"},Ce={class:"flex-1"},De={class:"flex items-end"},Fe=["disabled"],Pe={key:0,class:"mt-4 p-4 bg-green-50 border border-green-200 rounded"},Re={key:2,class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ne={class:"p-6"},Se={class:"p-4 bg-red-100 border border-red-400 text-red-700 rounded"},Me={key:3,class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Qe={class:"p-6"},Be={class:"bg-gray-50 p-4 rounded border"},Oe={class:"flex justify-between items-start"},Ve={class:"flex-1"},ze={class:"font-mono text-sm bg-white p-2 rounded border break-all"},Te={class:"flex-1 mx-3"},Ue={class:"font-mono text-sm bg-white p-2 rounded border break-all"},qe={key:4,class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ae={class:"p-6"},Ie={class:"bg-gray-50 p-4 rounded border"},je={class:"flex justify-between items-start"},Ee={style:{height:"120px"}},Le=["src"],$e={key:5,class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ge={class:"p-6"},Ke={class:"bg-gray-50 p-4 rounded border"},He={class:"flex justify-between items-start"},Je={class:"flex-1"},We={class:"font-mono text-sm bg-white p-2 rounded border break-all"},Ze={key:0,class:"font-mono bg-white p-2 rounded border break-all mt-3",style:{color:"green !important"}},Xe={class:"w-full md:w-2/2"},Ye=["disabled"],et=["disabled"],tt={key:6,class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},st={class:"p-6"},ot={class:"bg-green-50 p-4 rounded border border-green-200"},at={class:"flex justify-between items-start"},rt={class:"flex-1"},lt={class:"font-mono text-sm bg-white p-2 rounded border break-all"},dt={class:"font-mono text-sm bg-white p-2 rounded border break-all"},nt={class:"font-mono text-sm bg-white p-2 rounded border break-all"},it={class:"font-mono text-sm bg-white p-2 rounded border break-all"},vt={__name:"Scanner",setup(ut){const v=n(null),x=n(null),g=n(!1),p=n(!1),h=n(!1),a=n(""),o=n([]),b=n(!1),u=n("upload"),m=n(""),f=n(!1),y=n(null);H(()=>{const t=new URLSearchParams(window.location.search).get("code");t&&t.trim()!==""&&(u.value="find",m.value=t.trim(),o.value=[],a.value="")});const R=s=>{u.value=s,w()},q=s=>{const t=s.target.files[0];N(t)},A=s=>{s.preventDefault(),b.value=!1;const t=s.dataTransfer.files;t.length>0&&N(t[0])},I=s=>{s.preventDefault(),b.value=!0},j=s=>{s.preventDefault(),b.value=!1},N=s=>{if(!s)return;if(!s.type.startsWith("image/")){a.value="Please select a valid image file";return}if(s.size>5*1024*1024){a.value="File size must be less than 5MB";return}v.value=s,a.value="",o.value=[];const t=new FileReader;t.onload=k=>{x.value=k.target.result},t.readAsDataURL(s)},S=async()=>{if(!m.value.trim()){a.value="Please enter a code number";return}f.value=!0,a.value="";try{const s=new FormData;s.append("mode","find"),s.append("code",m.value.trim());const t=await P.post("/api/scanner",s,{headers:{"Content-Type":"multipart/form-data"}});o.value=t.data}catch(s){if(s.response)if(s.response.data.errors){const t=s.response.data.errors;a.value=t.code?t.code[0]:t.general||"Failed to find order"}else a.value=s.response.data.message||"Order not found";else a.value="Network error occurred";o.value=[],console.error("Search error:",s)}finally{f.value=!1}},E=async()=>{if(!v.value){a.value="Please select an image file first";return}g.value=!0,a.value="";try{const s=new FormData;s.append("mode","upload"),s.append("qr_image",v.value);const t=await P.post("/api/scanner",s,{headers:{"Content-Type":"multipart/form-data"}});o.value=t.data,console.log(t)}catch(s){if(s.response)if(s.response.data.errors){const t=s.response.data.errors;a.value=t.qr_image?t.qr_image[0]:t.general||"Failed to process QR code"}else a.value=s.response.data.message||"Failed to process QR code";else a.value="Network error occurred";console.error("Upload error:",s)}finally{g.value=!1}},L=async()=>{p.value=!0;try{const s=new FormData;s.append("data",JSON.stringify(o.value.data)),s.append("code",o.value.code);const t=await P.post("/api/qr-order",s,{headers:{"Content-Type":"multipart/form-data"}});h.value="Order is success",setTimeout(()=>{w()},3e3),console.log(t)}catch(s){console.error("Upload error:",s)}finally{p.value=!1}},w=()=>{v.value=null,x.value=null,m.value="",y.value&&(y.value.value=""),o.value=[],h.value="",a.value=""},$=()=>{var s;(s=y.value)==null||s.click()};return(s,t)=>{const k=T("VCol"),G=T("VRow");return l(),d(U,null,[C(J(W),{title:"QR Code Management"}),C(se,null,{header:_(()=>t[4]||(t[4]=[e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"QR Code Management",-1)])),default:_(()=>{var M,Q,B,O,V,z;return[e("div",oe,[e("div",ae,[e("div",re,[e("div",le,[t[5]||(t[5]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Select Action",-1)),e("div",de,[e("button",{onClick:t[0]||(t[0]=c=>R("upload")),class:D(["px-6 py-3 rounded-lg font-medium transition duration-200",u.value==="upload"?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"])}," 📷 Upload QR Code ",2),e("button",{onClick:t[1]||(t[1]=c=>R("find")),class:D(["px-6 py-3 rounded-lg font-medium transition duration-200",u.value==="find"?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"])}," 🔍 Find by Code Number ",2)])])]),u.value==="upload"?(l(),d("div",ne,[e("div",ie,[t[12]||(t[12]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Upload QR Code Image",-1)),e("input",{ref_key:"fileInput",ref:y,type:"file",accept:"image/*",onChange:q,class:"hidden"},null,544),e("div",{onDrop:A,onDragover:I,onDragleave:j,onClick:$,class:D(["border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors duration-200",b.value?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"])},[e("div",ue,[t[6]||(t[6]=e("svg",{class:"w-12 h-12 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),e("p",ce,r(b.value?"Drop your QR code image here":"Click to upload or drag and drop"),1),t[7]||(t[7]=e("p",{class:"text-sm text-gray-500"},"PNG, JPG, GIF up to 5MB",-1))])],34),x.value?(l(),d("div",me,[t[10]||(t[10]=e("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Preview:",-1)),e("div",ve,[e("img",{src:x.value,alt:"QR Code Preview",class:"w-32 h-32 object-contain border rounded"},null,8,ge),e("div",pe,[e("p",be,[t[8]||(t[8]=e("strong",null,"File:",-1)),F(" "+r((M=v.value)==null?void 0:M.name),1)]),e("p",fe,[t[9]||(t[9]=e("strong",null,"Size:",-1)),F(" "+r(Math.round(((Q=v.value)==null?void 0:Q.size)/1024))+" KB ",1)]),e("div",xe,[e("button",{onClick:E,disabled:g.value,class:"bg-blue-500 hover:bg-blue-700 w-full mt-2 disabled:bg-gray-400 text-white font-bold py-2 px-4 rounded transition duration-200"},r(g.value?"Processing...":"Process QR Code"),9,he)])])])])):i("",!0),g.value?(l(),d("div",ye,t[11]||(t[11]=[e("div",{class:"flex items-center space-x-2"},[e("svg",{class:"animate-spin h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),e("span",{class:"text-blue-700"},"Processing QR code...")],-1)]))):i("",!0)])])):i("",!0),u.value==="find"?(l(),d("div",we,[e("div",_e,[t[15]||(t[15]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Find Order by Code Number",-1)),e("div",ke,[e("div",Ce,[t[13]||(t[13]=e("label",{for:"codeNumber",class:"block text-sm font-medium text-gray-700 mb-2"}," Enter Code Number ",-1)),Z(e("input",{id:"codeNumber","onUpdate:modelValue":t[2]||(t[2]=c=>m.value=c),type:"text",placeholder:"Enter order code number...",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",onKeyup:Y(S,["enter"])},null,544),[[X,m.value]])]),e("div",De,[e("button",{onClick:S,disabled:f.value||!m.value.trim(),class:"bg-green-500 hover:bg-green-700 disabled:bg-gray-400 text-white font-bold py-2 px-6 rounded transition duration-200"},r(f.value?"Searching...":"Search"),9,Fe)])]),f.value?(l(),d("div",Pe,t[14]||(t[14]=[e("div",{class:"flex items-center space-x-2"},[e("svg",{class:"animate-spin h-5 w-5 text-green-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),e("span",{class:"text-green-700"},"Searching for order...")],-1)]))):i("",!0)])])):i("",!0),a.value?(l(),d("div",Re,[e("div",Ne,[e("div",Se,[t[16]||(t[16]=e("strong",null,"Error:",-1)),F(" "+r(a.value),1)])])])):i("",!0),o.value&&o.value.data?(l(),d("div",Me,[e("div",Qe,[t[19]||(t[19]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"QR Code Data",-1)),e("div",Be,[e("div",Oe,[e("div",Ve,[t[17]||(t[17]=e("p",{class:"text-sm text-gray-600 mb-1"},"Total Quantity:",-1)),e("p",ze,r(((O=(B=o.value)==null?void 0:B.data)==null?void 0:O.tq)??0),1)]),e("div",Te,[t[18]||(t[18]=e("p",{class:"text-sm text-gray-600 mb-1"},"Total Amount:",-1)),e("p",Ue,r(((z=(V=o.value)==null?void 0:V.data)==null?void 0:z.ta)??0),1)])])])])])):i("",!0),o.value?(l(),d("div",qe,[e("div",Ae,[t[20]||(t[20]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Order Items",-1)),e("div",Ie,[e("div",je,[C(G,null,{default:_(()=>[(l(!0),d(U,null,ee(o.value.items,(c,K)=>(l(),te(k,{cols:"6",sm:"12",lg:"2",key:K},{default:_(()=>[e("div",Ee,[e("img",{src:c.img,style:{width:"100px",height:"auto"},alt:""},null,8,Le)]),e("p",null,"Quantity - "+r(c.quantity),1),e("p",null,"No. "+r(c.id),1)]),_:2},1024))),128))]),_:1})])])])])):i("",!0),o.value&&o.value.data&&u.value==="upload"?(l(),d("div",$e,[e("div",Ge,[t[22]||(t[22]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Order Process",-1)),e("div",Ke,[e("div",He,[e("div",Je,[t[21]||(t[21]=e("p",{class:"text-sm text-gray-600 mb-1"},"Serial Number:",-1)),e("p",We,r(o.value.code),1),h.value!=""?(l(),d("p",Ze,r(h.value),1)):i("",!0),e("div",Xe,[e("button",{onClick:t[3]||(t[3]=c=>L()),disabled:p.value,class:"bg-blue-500 hover:bg-blue-700 w-full mt-2 disabled:bg-gray-400 text-white font-bold py-2 px-4 rounded transition duration-200"},r(p.value?"Processing...":"Process Order"),9,Ye),e("button",{onClick:w,disabled:g.value||p.value,class:"bg-gray-500 hover:bg-gray-700 w-full mt-2 disabled:bg-gray-400 text-white font-bold py-2 px-4 rounded transition duration-200"}," Clear ",8,et)])])])])])])):i("",!0),o.value&&o.value.data&&u.value==="find"?(l(),d("div",tt,[e("div",st,[t[28]||(t[28]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Found Order Information",-1)),e("div",ot,[e("div",at,[e("div",rt,[t[23]||(t[23]=e("p",{class:"text-sm text-gray-600 mb-1"},"Order Code:",-1)),e("p",lt,r(o.value.code),1),t[24]||(t[24]=e("p",{class:"text-sm text-gray-600 my-2"},"Name:",-1)),e("p",dt,r(o.value.data.n),1),t[25]||(t[25]=e("p",{class:"text-sm text-gray-600 my-2"},"Phone:",-1)),e("p",nt,r(o.value.data.p),1),t[26]||(t[26]=e("p",{class:"text-sm text-gray-600 my-2"},"City:",-1)),e("p",it,r(o.value.data.c),1),t[27]||(t[27]=e("p",{class:"font-mono bg-green-100 p-2 rounded border break-all mt-3 text-green-800"}," ✅ Order already exists in the system ",-1)),e("div",{class:"w-full md:w-2/2"},[e("button",{onClick:w,class:"bg-gray-500 hover:bg-gray-700 w-full mt-2 text-white font-bold py-2 px-4 rounded transition duration-200"}," Clear Search ")])])])])])])):i("",!0)])])]}),_:1})],64)}}};export{vt as default};
